# fldr rebuild clear

1. 现有问题

    1. reset_index消息目前已经作为fldr的最后一条消息, 但是装载事务的提交动作仍旧在clear消息中完成, 对于单机来说, 这里存在窗口

    2. 对于二级索引的处理, 需要增加索引生效失效前的锁表操作, 这里就引入了问题:

        1. 单机环境下, clear后发生reset_index, 其中进行锁表, 锁表操作和装载操作无关, 中间的窗口期若有其他会话对表做处理, 则数据可能错误, 索引数据丢失

        2. dpc环境下, clear发生在bp, reset_index发生在sp, sp上的锁不足以阻止bp clear结束后, 其他会话对表做处理, 数据仍可能错误, 索引数据丢失

        3. 无论哪种环境, 均有可能出现, reset_index锁超时问题

2. 处理方案

    1. 锁应该在reset_index时释放